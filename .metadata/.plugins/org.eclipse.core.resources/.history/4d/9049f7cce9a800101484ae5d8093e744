<%@page errorPage="exception.jsp" %>
<%@page import="de.uniwue.apps.jm1.User"%>
<%@page import="de.uniwue.apps.jm1.Item"%>
<%@page import="de.uniwue.apps.jm1.Main"%>
<%@page import="java.text.DecimalFormat"%>
<%
User user = (User) session.getAttribute("user");
if (user == null) {
    response.sendRedirect("benutzer.jsp");
    return;
}
user = User.getUserbyUID("" + user.getUid());
session.setAttribute("user", user);

int isSuccess = 0;
try {
    isSuccess = Integer.parseInt(request.getParameter("isSuccess"));
} catch(Exception e) {
    // positiv bleibt null
}

DecimalFormat euroFormat = new DecimalFormat("#,##0.00 €");
String guthaben = euroFormat.format(user.getGuthaben() / 100.0);
%>
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>WueKaStL</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-3.7.1.min.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="user-info-header">
            <div class="user-name-header"><%= user.getVorname() %> <%= user.getNachname() %></div>
            <div class="saldo"><%= guthaben %></div>
        </div>
        
         <a class="logo" href="index.jsp" >WueKaStL</a>
         
         
             <a href="auth/abmeldung" class="btn btn-danger">Logout</a>
    </div>

    <!-- Hauptbereich -->
    <div class="main">
        <h2 class="main-title">Getränk auswählen</h2>
        
        <div class="content-container">
            <div class="drinks-section">
                <div class="drinks-grid">
                    <% 
                    for (Item item : Item.getItLi()) {
                        if (item.isAktiv()) {
                            String preis;
                            int preisInCent = item.getPreis();
                            if (preisInCent >= 100) {
                                preis = euroFormat.format(preisInCent / 100.0);
                            } else {
                                preis = preisInCent + " ct";
                            }
                    %>
                        <div class="drink-card add-item" 
                             data-uid="<%= item.getUid() %>" 
                             data-itempreis-id="<%= item.getItempreisID() %>"
                             data-name="<%= item.getName() %>"
                             data-price="<%= preisInCent %>">
                            <div class="drink-name"><%= item.getName() %></div>
                            <img alt="<%= item.getName() %>" class="icon-img" src="<%= item.getIconUrl() %>">
                            <div class="drink-price"><%= preis %></div>
                        </div>
                    <% 
                        }
                    } 
                    %>
                </div>
            </div>
            
            <div class="warenkorb-box">
                <h3>Warenkorb</h3>
                <ul class="warenkorb" id="warenkorb-liste">
         
                </ul>
                <div class="warenkorb-summe">
                    <span class="sum-label">Gesamtsumme:</span>
                    <div class="sum-actions">
                        <span class="sum-value">
                            0<span class="euro">€</span>
                        </span>
                        <form action="buchungen" id="warenkorb-form" method="POST" style="display: inline;">
                            <button type="submit" class="bestaetigen" name="method" value="strich" disabled>
                                Bestätigen
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

			<%if(isSuccess == 1){ %>
			<div class="success">
    		<div class="success__title">Hat alles funktioniert ;D</div>
    		<div class="success__close"><svg  width="20" viewBox="0 0 20 20" height="20"><path fill="#393a37" d="m15.8333 5.34166-1.175-1.175-4.6583 4.65834-4.65833-4.65834-1.175 1.175 4.65833 4.65834-4.65833 4.6583 1.175 1.175 4.65833-4.6583 4.6583 4.6583 1.175-1.175-4.6583-4.6583z"></path></svg></div>
			</div>
			<%} %>
    <div class="footer">
			<div class="navigation">
				<a href="verlauf.jsp?tablet=1" class="btn btn-auswahl">Verlauf</a>
				<a href="profil.jsp" class="btn btn-auswahl">Profil</a>
				<% if(user.isAdmin()) { %>
                        <a href="admin_item.jsp" class="btn btn-auswahl admin-nav">Artikel</a>
                        <a href="admin_user.jsp" class="btn btn-auswahl admin-nav">Benutzer und Buchungen</a>
                    <% } %>
			</div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>